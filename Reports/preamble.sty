\ProvidesPackage{preamble}

%% Preamble
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% Macros
\usepackage{etoolbox} % enable tools for writing macros

%% Math
\usepackage{amsmath} % improve math output
\usepackage{amssymb} % additional math symbols
\usepackage{mathtools} % add additional math symbols
\usepackage{siunitx} % improve typesetting of SI units
\usepackage{bm} % improve bold rendering of math symbols
%\usepackage{tensor} % improve handling of tensor indices

%% Figures
\usepackage{graphicx} % improve graphics inclusion
\usepackage[labelsep=period,justification=justified]{caption} % allow changes to figure captions
\usepackage[subrefformat=simple,labelformat=simple]{subcaption} % allow inclusion of subfigures

%% Special Symbols
\usepackage{physics} % common symbols used in physics

%% Formatting
\usepackage{nth} % allow typesetting of ordinals
\usepackage{microtype} % improved kerning and formatting
\usepackage{lineno} % turn on line numbering

%% Emphasis
\usepackage{color} % add colored text
\usepackage[abbreviations, british, xlatin]{foreign} % define commands \ie \eg and more

%% Citations and References
\usepackage{natbib} % allow use of bibliography
\usepackage{hyperref} % hyperlink references. Make sure to load last
\hypersetup{colorlinks, % remove borders, but color links
            linkcolor=black,
            citecolor=blue, % SIO
            urlcolor=black,
            }
\usepackage{cleveref} % improve references (load laster than hyperref)

\crefname{equation}{}{} % redefine equation to not show word "eq."
\Crefname{equation}{Equation}{Equations}

\crefname{equations}{}{} % define plural equations
\Crefname{equations}{Equations}{Equations}

% Use \S symbol for section and subsection names (\S\S for plural), but
% not at beginning of sentence
\crefname{section}{\S}{\S\S}
\Crefname{section}{Section}{Sections}
\crefname{subsection}{\S}{\S\S}
\Crefname{subsection}{Subsection}{Subsection}

% Don't abbreviate figure
\crefname{figure}{figure}{figures}

\crefname{figures}{figures}{figures} % define plural figures
\Crefname{Figures}{Figures}{Figures}

% Define macro giving cref's representation of figure
\newcommand{\figname}{\cref@figure@name}
\newcommand{\Figname}{\Cref@figure@name}
\newcommand{\figsname}{\cref@figures@name}
\newcommand{\Figssname}{\Cref@figures@name}

% Define macro giving cref's representation of equation
\newcommand{\eqname}{\cref@equation@name}
\newcommand{\Eqname}{\Cref@equation@name}
\newcommand{\eqsname}{\cref@equations@name}
\newcommand{\Eqsname}{\Cref@equations@name}

% Don't put period after etc
\renewcommand*{\etc}{\foreignabbrfont{etc}}

%% Redefine commands
\renewcommand*{\vec}[1]{\mathbf{\bm{#1}}}
\renewcommand*{\vu}[1]{\mathbf{\bm{\hat{#1}}}}

% Allow SIrange or numrange to be used in math mode
\sisetup{mode=text,range-phrase = {\text{~to~}}, separate-uncertainty=true, group-digits=false}

% Use an en-dash for cleveref ranges
\newcommand{\crefrangeconjunction}{--}

% Only hyperlink the year of a citation (requires etoolbox package)
% Source: https://tex.stackexchange.com/questions/23227
% Patch case where name and year are separated by aysep
\patchcmd{\NAT@citex}
  {\@citea\NAT@hyper@{%
     \NAT@nmfmt{\NAT@nm}%
     \hyper@natlinkbreak{\NAT@aysep\NAT@spacechar}{\@citeb\@extra@b@citeb}%
     \NAT@date}}
  {\@citea\NAT@nmfmt{\NAT@nm}%
   \NAT@aysep\NAT@spacechar\NAT@hyper@{\NAT@date}}{}{}

% Patch case where name and year are separated by opening bracket
\patchcmd{\NAT@citex}
  {\@citea\NAT@hyper@{%
     \NAT@nmfmt{\NAT@nm}%
     \hyper@natlinkbreak{\NAT@spacechar\NAT@@open\if*#1*\else#1\NAT@spacechar\fi}%
       {\@citeb\@extra@b@citeb}%
     \NAT@date}}
  {\@citea\NAT@nmfmt{\NAT@nm}%
   \NAT@spacechar\NAT@@open\if*#1*\else#1\NAT@spacechar\fi\NAT@hyper@{\NAT@date}}
  {}{}
